<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DUC Entregas</title>
    <link rel="icon" href="/assets/favicon.png" type="image/png">
    <link rel="stylesheet" type="text/css" href="styles.css"> <!-- Vincula o arquivo CSS externo -->
</head>
<body>
    <div class="logo">
        <img src="assets/logo.png" alt="Duclog Logo">
    </div>
    <div class="flex-container">
        <div class="container">
            <h2>Calcule seu Frete!</h2>
            <input type="text" id="destino" placeholder="Digite o endereço completo para entrega:">
            <button class="blue-button" onclick="obterDistancia()">
                <img src="assets/calculadora.png" class="calc-icon">
                Calcular Frete
            </button>
            <p id="resultado"></p>
            <!-- Botão para enviar mensagem para o WhatsApp -->
            <button class="green-button" onclick="enviarWhatsapp()">
                <img src="assets/whatsapp.png" class="whatsapp-icon">
                Enviar mensagem via WhatsApp
            </button>
        </div>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBoKr_lrfasZ6AhN14JimI5-f9qVTaQHKQ&libraries=places&language=pt-BR"></script>
    <script>
        // Função para inicializar o autocomplete
        function initAutocomplete() {
            const input = document.getElementById('destino');
            const autocomplete = new google.maps.places.Autocomplete(input);
        }

let cost; // Variável global para armazenar o custo

async function obterDistancia() {
    try {
        const destino = document.getElementById('destino').value;
        const response = await fetch('https://d1r3ct0ry.pythonanywhere.com/distance?destinations=' + encodeURIComponent(destino));
        
        if (!response.ok) {
            throw new Error('Erro ao obter distância.');
        }

        const data = await response.json();
        
        // Verifica se há resultados
        if (data.status === 'OK') {
            const distance = data.rows[0].elements[0].distance.value / 1000; // Obtém a distância em quilômetros
            
            if (distance < 10) {
                cost = 14.00; // Define o custo como R$ 14,00 se a distância for menor que 10 km
            } else {
                cost = distance * 1.4; // Calcula o custo baseado na distância (multiplica por 1.4 a cada km)
            }
            
            document.getElementById('resultado').innerText = `Distância: ${distance.toFixed(2)} km\nCusto de entrega: R$ ${cost.toFixed(2)}`; // Exibe a distância e o custo
        } else {
            throw new Error('Nenhum resultado encontrado.');
        }
    } catch (error) {
        console.error(error);
        document.getElementById('resultado').innerText = 'Erro ao calcular a distância.';
    }
}

// Função para enviar mensagem via WhatsApp
function enviarWhatsapp() {
    const destino = document.getElementById('destino').value;
    const mensagem = `Olá, gostaria de solicitar o frete para o seguinte endereço: ${destino}, com o seguinte valor sugerido: R$ ${cost.toFixed(2)}`;
    const link = `https://api.whatsapp.com/send?phone=5521970970091&text=${encodeURIComponent(mensagem)}`;
    window.open(link, '_blank');
}

        // Inicializa o autocomplete quando a página é carregada
        window.onload = function() {
            initAutocomplete();
        };
    </script>
</body>
</html>
